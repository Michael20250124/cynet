<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>資安事件分析工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-2xl">
        <h1 class="text-2xl font-bold mb-4 text-center">資安事件分析工具</h1>
        <p class="text-gray-600 mb-4">請上傳資安事件報告檔案（.txt）或直接貼上文字內容進行分析。</p>
        
        <!-- File Upload -->
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">上傳檔案</label>
            <input type="file" id="fileInput" accept=".txt" class="w-full p-2 border rounded">
        </div>
        
        <!-- Textarea for Pasting -->
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">或貼上事件報告內容</label>
            <textarea id="textInput" rows="8" class="w-full p-2 border rounded" placeholder="在此貼上資安事件報告內容..."></textarea>
        </div>
        
        <!-- Analyze Button -->
        <button onclick="analyzeIncident()" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">分析報告</button>
        
        <!-- Output Area -->
        <div id="output" class="mt-6 hidden">
            <h2 class="text-xl font-semibold mb-4">分析結果</h2>
            <table class="w-full border-collapse border border-gray-300">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="border border-gray-300 p-2">類別</th>
                        <th class="border border-gray-300 p-2">詳情</th>
                    </tr>
                </thead>
                <tbody id="outputTable"></tbody>
            </table>
            <div id="recommendations" class="mt-4"></div>
            <div id="risks" class="mt-4"></div>
        </div>
    </div>

    <script>
        function analyzeIncident() {
            const fileInput = document.getElementById('fileInput');
            const textInput = document.getElementById('textInput');
            const output = document.getElementById('output');
            const outputTable = document.getElementById('outputTable');
            const recommendations = document.getElementById('recommendations');
            const risks = document.getElementById('risks');

            // Reset output
            outputTable.innerHTML = '';
            recommendations.innerHTML = '';
            risks.innerHTML = '';
            output.classList.add('hidden');

            // Handle file or text input
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                if (file.type !== 'text/plain') {
                    alert('請上傳 .txt 檔案！');
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    processIncident(e.target.result);
                };
                reader.readAsText(file);
            } else if (textInput.value.trim()) {
                processIncident(textInput.value);
            } else {
                alert('請上傳檔案或輸入文字內容！');
                return;
            }

            function processIncident(text) {
                // Initialize data object
                const data = {
                    classification: '',
                    severity: '',
                    detectionTimeLocal: '',
                    detectionTimeUTC: '',
                    malwareType: '',
                    remediationStatus: '',
                    hostName: '',
                    hostIP: '',
                    os: '',
                    filePath: '',
                    fileSignature: '',
                    fileSHA256: '',
                    parentProcess: '',
                    grandparentProcess: '',
                    socEmail: '',
                    socPhone: ''
                };

                // Parse text for key fields
                const lines = text.split('\n');
                lines.forEach(line => {
                    if (line.includes('Classification:')) data.classification = line.split('Classification:')[1].trim();
                    if (line.includes('Severity:')) data.severity = line.split('Severity:')[1].trim();
                    if (line.includes('Detection Time Local')) data.detectionTimeLocal = line.split('Detection Time Local')[1].trim();
                    if (line.includes('Detection Time UTC')) data.detectionTimeUTC = line.split('Detection Time UTC')[1].trim();
                    if (line.includes('Malware Type')) data.malwareType = line.split('Malware Type')[1].trim();
                    if (line.includes('Remediation Status')) data.remediationStatus = line.split('Remediation Status')[1].trim();
                    if (line.includes('Hostname')) data.hostName = line.split('Hostname')[1].trim();
                    if (line.includes('Host Ip')) data.hostIP = line.split('Host Ip')[1].trim();
                    if (line.includes('OS Version')) data.os = line.split('OS Version')[1].trim();
                    if (line.includes('Infected file')) data.filePath = line.split('Infected file')[1].trim();
                    if (line.includes('Infected file SignatureStatus')) data.fileSignature = line.split('Infected file SignatureStatus')[1].trim();
                    if (line.includes('Infected file SHA256')) data.fileSHA256 = line.split('Infected file SHA256')[1].trim();
                    if (line.includes('Process Path') && line.includes('lsass.exe')) data.parentProcess = line.split('Process Path')[1].trim();
                    if (line.includes('Process Path') && line.includes('wininit.exe')) data.grandparentProcess = line.split('Process Path')[1].trim();
                    if (line.includes('SOC Email')) data.socEmail = line.split('SOC Email')[1].trim();
                    if (line.includes('SOC Phone')) data.socPhone = line.split('SOC Phone')[1].trim().replace(/US:/g, '美國:').replace(/EU:/g, '歐洲:').replace(/IL:/g, '以色列:');
                });

                // Generate table rows
                const fields = [
                    { label: '事件分類', value: data.classification },
                    { label: '嚴重性', value: data.severity },
                    { label: '檢測時間 (本地)', value: data.detectionTimeLocal },
                    { label: '檢測時間 (UTC)', value: data.detectionTimeUTC },
                    { label: '惡意軟體類型', value: data.malwareType },
                    { label: '處理狀態', value: data.remediationStatus },
                    { label: '主機名稱', value: data.hostName },
                    { label: '主機 IP', value: data.hostIP },
                    { label: '作業系統', value: data.os },
                    { label: '受感染檔案', value: data.filePath },
                    { label: '檔案簽章', value: data.fileSignature },
                    { label: '檔案 SHA256', value: data.fileSHA256 },
                    { label: '父進程', value: data.parentProcess },
                    { label: '祖父進程', value: data.grandparentProcess },
                    { label: 'SOC 聯繫方式', value: `${data.socEmail}<br>${data.socPhone}` }
                ];

                fields.forEach(field => {
                    if (field.value) {
                        const row = `<tr><td class="border border-gray-300 p-2 font-semibold">${field.label}</td><td class="border border-gray-300 p-2">${field.value}</td></tr>`;
                        outputTable.innerHTML += row;
                    }
                });

                // Recommendations
                recommendations.innerHTML = `
                    <h3 class="text-lg font-semibold mb-2">檢查建議</h3>
                    <ul class="list-disc pl-5">
                        <li>確認檔案 <code>${data.filePath}</code> 是否已重新命名為 .cynet。</li>
                        <li>使用防毒軟體對主機 ${data.hostName} (${data.hostIP}) 進行全系統掃描。</li>
                        <li>檢查進程 <code>${data.parentProcess}</code> 和 <code>${data.grandparentProcess}</code> 是否異常。</li>
                        <li>監控主機網路活動，確認無異常連線。</li>
                        <li>升級 ${data.os} 至受支援版本（該系統已停止支援）。</li>
                    </ul>
                `;

                // Risks
                risks.innerHTML = `
                    <h3 class="text-lg font-semibold mb-2">資安風險</h3>
                    <ul class="list-disc pl-5">
                        <li><strong>勒索軟體風險</strong>：${data.malwareType} 可能加密檔案或洩露資料，影響業務。</li>
                        <li><strong>系統漏洞</strong>：過時作業系統易受攻擊，需升級。</li>
                        <li><strong>提權風險</strong>：惡意檔案與核心進程相關，可能被用於取得系統控制權。</li>
                    </ul>
                `;

                output.classList.remove('hidden');
            }
        }
    </script>
</body>
</html>
